<!DOCTYPE html>
<html>
<head>
  <title>Decoder Test</title>
  <script type="module">
    import { readBarcodesFromImageData } from 'https://esm.sh/zxing-wasm@1.5.0/reader';
    
    window.testImage = async function(imagePath) {
      const img = new Image();
      img.src = imagePath;
      await new Promise(resolve => img.onload = resolve);
      
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      const imageData = ctx.getImageData(0, 0, img.width, img.height);
      
      const results = await readBarcodesFromImageData(imageData, {
        formats: ['Aztec'],
        tryHarder: true,
        tryRotate: true,
        tryInvert: true,
      });
      
      console.log('Results:', results);
      if (results.length > 0) {
        console.log('Position:', results[0].position);
        console.log('Text:', results[0].text);
      }
    }
  </script>
</head>
<body>
  <h1>Decoder Test</h1>
  <input type="file" id="file" accept="image/*">
  <script>
    document.getElementById('file').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        await window.testImage(url);
      }
    });
  </script>
</body>
</html>
